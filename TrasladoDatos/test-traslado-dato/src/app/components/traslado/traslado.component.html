<div class="flex flex-col lg:flex-row w-full min-h-screen p-8 bg-gray-50 dark:bg-gray-900 gap-8">

    <!-- Sección izquierda -->
    <div class="w-full lg:w-1/2 h-auto bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-300 dark:border-gray-700">
      <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-300 mb-6">{{'labels.subirArchivo' | translate}}</h2>
      
      <div class="mb-6">
        <label for="sheetSelect" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">
          {{'labels.soloArchivosExcel' | translate}} <strong>.xlsx, .xls</strong>
        </label>
        
        <!-- Solo mostrar el área de carga cuando no hay un archivo cargado -->
        <div *ngIf="!fileSeleccionado" class="relative flex items-center justify-center w-full h-32 bg-gray-100 dark:bg-gray-700 border-2 border-dashed border-gray-300 dark:border-gray-500 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all">
          <input
            id="fileInput"
            type="file"
            accept=".xlsx, .xls"
            class="absolute inset-0 opacity-0 cursor-pointer"
            (change)="cargarFile($event)"
            #fileInput
          />
          <div class="text-center">
            <i class="fa-solid fa-upload text-gray-500 dark:text-gray-400 text-3xl mb-2"></i> <!-- Icono -->
            <p class="text-gray-500 dark:text-gray-400 text-lg">{{'labels.hacerClickOArrastrar' | translate}}</p>
          </div>
        </div>
      
        <!-- Mensaje de advertencia si ya hay un archivo cargado -->
        <div *ngIf="mostrarMensajeAdvertencia" class="mt-2 text-red-600 dark:text-red-400 text-sm">
          <p>{{'labels.archivoYaCargado' | translate}}</p>
        </div>
      </div>
      
      <!-- Mostrar el archivo subido con su tamaño y opción para eliminar -->
      <div *ngIf="fileSeleccionado" class="mt-4 p-4 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg flex justify-between items-center">
        <div>
          <p class="text-gray-600 dark:text-gray-300">{{'labels.archivoSeleccionado' | translate}}: <span class="font-semibold text-gray-800 dark:text-gray-100">{{ fileSeleccionado.name }}</span></p>
          <p class="text-gray-600 dark:text-gray-300">{{'labels.tamañoArchivo' | translate}}: <span class="font-semibold text-gray-800 dark:text-gray-100">{{ fileSeleccionado.size / 1024 | number: '1.2-2' }} KB</span></p>
        </div>
        
        <button 
          (click)="removerFile()" 
          *ngIf="!cargandoHojas" 
          class="text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-500 focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <!-- Selección de hojas del archivo Excel -->
      <div class="mb-6 mt-2">
        <label for="sheetSelect" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">
          {{'labels.seleccinarHoja' | translate}}
        </label>
      
        <!-- Indicador de carga -->
        <p *ngIf="cargandoHojas" class="text-sm text-blue-600 dark:text-blue-400 mt-1 flex items-center gap-2">
          <span class="w-4 h-4 border-2 border-gray-500 dark:border-gray-400 border-t-transparent rounded-full animate-spin"></span>
          {{'labels.cargandoHojas' | translate}}...
        </p>
      
      
        <!-- Dropdown personalizado -->
        <div class="relative" *ngIf="!cargandoHojas && hojas.length > 0">
          <button
            (click)="toggleDropdown()"
            class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm px-4 py-2 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none flex justify-between items-center"
          >
            <span>{{ hojaSeleccionada || 'labels.seleccioneHoja'  | translate }}</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 transition-transform duration-300"
              [ngClass]="{ 'rotate-180': dropdownAbierto }"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 011.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
      
        <!-- Opciones -->
        <ul
        *ngIf="dropdownAbierto"
        class="absolute z-10 w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-md mt-2 max-h-60 overflow-y-auto"
        >
          <li
            *ngFor="let sheet of hojas"
            (click)="seleccionarHoja(sheet)"
            class="px-4 py-2 text-black dark:text-white hover:bg-blue-400 hover:text-white cursor-pointer transition-colors"
          >
            {{ sheet }}
          </li>
        </ul>

        </div>
      </div>
      
      <!-- Mostrar la hoja seleccionada -->
      <div class="mb-6">
        <p class="text-gray-600 dark:text-gray-300">{{'labels.hojaSeleccionada' | translate}}: <span class="font-bold text-gray-800 dark:text-gray-100">{{ hojaSeleccionada }}</span></p>
      </div>
    
  
      <!-- Botón para trasladar los datos -->
      <div class="flex flex-col items-center justify-center space-y-4">
        <!-- Botón -->
        <button
          class="bg-blue-500 dark:bg-blue-600 text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-blue-600 dark:hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 ease-in-out"
          [disabled]="!hojaSeleccionada || cargandoTraslado"
          (click)="mostrarModalTraslado()"
        >
        {{'buttonsLabels.btnTrasladarDatos' | translate}}
        </button>
      
      
        <!-- Spinner y texto informativo -->
        <div *ngIf="cargandoTraslado" class="flex flex-col items-center justify-center mt-4 space-y-2">
          <div class="w-8 h-8 border-4 border-gray-600 dark:border-gray-500 border-t-transparent rounded-full animate-spin"></div>
          <p class="text-gray-600 dark:text-gray-300 text-sm">{{'labels.trasladandoDatos' | translate}}...</p>
        </div>
      </div>
    </div>

    <!-- Sección derecha -->
    <div class="w-full lg:w-1/2 h-auto bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-300 dark:border-gray-700">
      <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-300 mb-6">{{'labels.vistaDatosRegistrados' | translate}}</h2>
      <!-- Tabla de registro SQL -->
      <div class="overflow-x-auto" style="max-height: 400px;">
        <table class="min-w-full table-auto border-collapse">
          <thead>
            <tr class="bg-gray-100 dark:bg-gray-700">
              <th class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-left text-sm font-medium text-gray-700 dark:text-gray-300">{{'fields.consecutivoInterno' | translate}}</th>
              <th class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-left text-sm font-medium text-gray-700 dark:text-gray-300">{{'fields.estructura' | translate}}</th>
              <th class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-left text-sm font-medium text-gray-700 dark:text-gray-300">{{'fields.userName' | translate}}</th>
              <th class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-left text-sm font-medium text-gray-700 dark:text-gray-300">{{'fields.fechaHora' | translate}}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dato of datosTabla" class="bg-gray-200 dark:bg-gray-900">
              <td class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-300">{{ dato.consecutivo_Interno }}</td>
              <td class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all cursor-pointer" (click)="seleccionarEstructura(dato.estructura)">
                <div class="overflow-x-auto" style="max-width: 300px; white-space: nowrap;">
                  {{ dato.estructura }}
                </div>
                <span class="text-xs text-blue-500">{{'fields.clicDetalles' | translate}}</span>
              </td>
              <td class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-300">{{ dato.userName }}</td>
              <td class="py-3 px-4 border-b border-gray-300 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-300">{{ dato.fecha_Hora | date: 'short' }}</td>
            </tr>
          </tbody>
        </table>
      </div>


      <!-- Botón de filtros (mostrar tabla o json) -->
      <div class="mt-4 flex justify-end relative">
        <!-- Botón de filtros -->
        <button 
          [disabled]="!columnaSeleccionada"
          (click)="mostrarFiltros = !mostrarFiltros" 
          class="px-3 py-1.5 text-sm font-medium rounded-lg focus:outline-none transition-all"
          [ngClass]="{
            'bg-gray-400 cursor-not-allowed': !columnaSeleccionada, 
            'bg-blue-500 text-white hover:bg-blue-600': columnaSeleccionada, 
            'bg-gray-300 text-gray-600 hover:bg-gray-400': !columnaSeleccionada && !mostrarFiltros  
          }">
          {{'buttonsLabels.btnFiltrarDatos' | translate}}
        </button>
        
        <!-- Dropdown de filtro, se muestra cuando mostrarFiltros es true -->
        <div *ngIf="mostrarFiltros" class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-300 dark:border-gray-700 z-10 origin-top-right">
          <ul class="divide-y divide-gray-200 dark:divide-gray-700">
            <!-- Opción de mostrar Tabla -->
            <li>
              <button (click)="mostrarComoTabla = true; mostrarFiltros = false; mostrarEstructura = false" 
                      class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-t-lg w-full text-left">
                <span class="flex items-center justify-between">
                  {{'labels.opcionTabla' | translate}}
                  <i *ngIf="mostrarComoTabla" class="fas fa-check text-green-500"></i> <!-- Ícono de check para 'Tabla' -->
                </span>
              </button>
            </li>
            <!-- Opción de mostrar JSON -->
            <li>
              <button (click)="mostrarEstructura = true; mostrarComoTabla = false; mostrarFiltros = false" 
                      class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 w-full text-left">
                <span class="flex items-center justify-between">
                  JSON
                  <i *ngIf="mostrarEstructura" class="fas fa-check text-green-500"></i> <!-- Ícono de check para 'JSON' -->
                </span>
              </button>
            </li>
          </ul>
        </div>
      </div>

      <!-- Contenedor con tabla para mostrar -->
      <div *ngIf="mostrarComoTabla" class="mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-600">
        <h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">
          {{'labels.tablaDetallada' | translate}}
          <span class="text-sm ml-2 text-gray-600 dark:text-gray-100">{{'labels.noRegistros' | translate}}: {{ datosTablaDetalle.length }}</span>
        </h3>

        <!-- Tabla del JSON -->
        <div class="overflow-x-auto">
          <div class="overflow-y-auto max-h-[400px]"> <!-- Desplazamiento vertical -->
            <table class="min-w-full table-auto border-collapse">
              <thead>
                <tr class="bg-gray-200 dark:bg-gray-600">
                  <!-- Mostrar los encabezados dinámicamente -->
                  <th *ngFor="let encabezado of encabezadosTabla" 
                      class="py-2 px-4 border-b border-gray-300 dark:border-gray-600 text-left text-sm font-medium text-gray-700 dark:text-gray-300">
                    {{ encabezado }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <!-- Mostrar las filas dinámicamente -->
                <tr *ngFor="let fila of datosTablaDetalle" class="hover:bg-gray-100 dark:hover:bg-gray-600">
                  <td *ngFor="let encabezado of encabezadosTabla" 
                      class="py-2 px-4 border-b border-gray-300 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-300">
                    {{ fila[encabezado] }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Botón para cerrar -->
        <button class="mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-500" 
                (click)="cerrarVista()">
                {{'buttonsLabels.btnCerrar' | translate}}
        </button>
      </div>


      <!-- Estructura o apartado para JSON FOMATEADO-->
      <div *ngIf="mostrarEstructura" class="mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-600">
        <h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">{{'labels.estructuraSeleccionada' | translate}}:</h3>
      
        <!-- Mostrar JSON formateado con colores -->
        <pre *ngIf="estructuraSeleccionada && estructuraSeleccionada.length" 
              class="bg-gray-800 p-3 rounded-lg border border-gray-300 text-sm text-gray-100 overflow-auto max-h-64"
              [innerHTML]="formatearJSON(estructuraSeleccionada)">
        </pre>
      
        <!-- Manejo de caso cuando no es JSON o no tiene contenido -->
        <div *ngIf="!estructuraSeleccionada || estructuraSeleccionada.length === 0">
          {{'messages.errorProcesarContenido' | translate}}
        </div>
      
        <button class="mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" 
                (click)="cerrarVista()">
                {{'buttonsLabels.btnCerrar' | translate}}
        </button>
      </div>
      
    </div>
</div>
<app-messages
  [isVisibleModal]="isVisibleModal"
  [mensajeModal]="'¿Está seguro de que desea trasladar los datos seleccionados?'"
  (confirmarAccion)="trasladarDatos()"
  (cancelarAccion)="isVisibleModal = false"
  [mensajeExito]="isVisibleExito ? mensajeExito : ''" 
  [mensajeAlerta]="isVisibleAlerta ? mensajeAlerta : ''"
  [isVisibleExito]="isVisibleExito" 
  [isVisibleAlerta]="isVisibleAlerta" 
></app-messages>
